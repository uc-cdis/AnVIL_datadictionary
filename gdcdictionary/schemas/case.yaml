$schema: "http://json-schema.org/draft-04/schema#"

id: "case"
title: Case
type: object
namespace: https://dcp.bionimbus.org/
category: administrative
program: '*'
project: '*'
description: >
  The collection of all data related to a specific subject in the
  context of a specific experiment. 
additionalProperties: false
submittable: true
validators: null

systemProperties:
  - id
  - project_id
  - created_datetime
  - updated_datetime
  - state

links:
  - exclusive: false
    required: true
    subgroup:
      - name: families 
        backref: cases
        label: member_of
        target_type: family
        multiplicity: many_to_one
        required: false
      - name: studies 
        backref: cases
        label: member_of
        target_type: study
        multiplicity: many_to_many
        required: false

required:
  - type
  - submitter_id

uniqueKeys:
  - [id]
  - [project_id, submitter_id]

# Case properties
properties:
  $ref: "_definitions.yaml#/ubiquitous_properties"

  amputation_type:
    description: >
      If amputated, the amputation type for leg, above the knee or below the knee. (GTEx)
    type: string

  multiple_datasets:
    description: >
      Flag if an individual has data represented in multiple data types (Ex: Yes if both exome and genome data is available for an individual). (CMG)
    enum: 
      - "Yes"
      - "No"

  pmid_id:
    description: >
      Case specific PubMed ID if applicable. (CMG)
    type: integer

  dbgap_submission:
    description: >
      Flag if sample has been submitted to dbGaP. (CMG)
    enum: 
      - "Yes"
      - "No"

  dbgap_study_id:
    description: >
      PHS ID for study. (CMG)
    type: string

  dbgap_subject_id:
    description: >
      Subject identifier used in dbGaP (if previously submitted). (CMG)
    type: string

  twin_id:
    description: >
      subject_id for twins, triplets, etc. (CMG)
    type: string

  proband_relationship:
    description: >
      Text description of individual relationship to proband in family, especially useful to capture relationships when connecting distant relatives and connecting relatives not studied. (CMG)
    type: string

  family_id:
    description: >
      The family submitter_id. (CMG)
    type: string

  maternal_id:
    description: >
      The case submitter_id for the mother. (CMG)  
    type: string

  paternal_id:
    description: >
      The case submitter_id for the father. (CMG) 
    type: string

  site:
    description: >
      Site where the case was recruted.
    type: string

  cohort_id:
    description: >
      The study subgroup that the participant belongs to. This indicates whether the participant was a postmortem donor, 
      an organ donor, or a surgical donor. Â  
    enum: 
      - Postmortem
      - Organ Donor (OPO)
      - Surgical Donor

  eligibility:
    description: >
      A verification field of whether the Donor has met the overall eligibility criteria for GTEx collection based on answers 
      to eligibility questions. All Eligibility conditions require confirmation from the donor procurement team (staff team where 
      tissue collection and data abstraction takes place) and must be met in order for donor to eligible. (GTEx)
    type: boolean

  index_date:
    description: >
      Indicates whether the time point reference begins at the donor's actual death, presumed death, 
      or when the cross clamp was applied in the case of surgical donors.
    enum:
      - Actual Death
      - Presumed Death
      - Cross Clamp
      - Study Enrollment
      - Diagnosis
      - First Patient Visit

  transplanted_organ:
    description: >
      If the Donor was an Organ Donor, which Organs were donated.
    type: string

  consent_group:
    description: >
        Data Use Restrictions that are used to indicate restrictions for datasets. (CMG) \n
        Based on the Data Use Ontology : see http://www.obofoundry.org/ontology/duo.html \n
        GRU - For general research use for any research purpose. Example of usage: This includes but is not limited to: health/medical/biomedical purposes, fundamental biology research, the study of population origins or ancestry, statistical methods and algorithms development, and social-sciences research. \n
        HMB - Use of the data is limited to health/medical/biomedical purposes; does not include the study of population origins or ancestry. \n
        DS-X - Use of the data must be related to [disease]. \n
        NPU - Use of the data is limited to not-for-profit organizations and not-for-profit use, non-commercial use. \n
        IRB - Requestor must provide documentation of local IRB/REC approval.
    type: array
    items:
      type: string

  cohort:
    description: >
      The study subgroup that the participant belongs to. This indicates whether the participant was a postmortem donor, an organ donor, or a surgical donor. (GTEx)
    type: string


  transplanted_organ:
    description: >
      If the Donor was an Organ Donor, which Organs were donated.
    type: string

  unit_site:
    description: >
      harmonization unit for site
    type: string

  is_proband:
    term:
      $ref: "_terms.yaml#/is_proband"
    type: boolean
    
  relationship_to_proband:
    term:
      $ref: "_terms.yaml#/relationship_to_proband"
    type: string

  affected_status:
    description: >
      "Indicate affected status of individual. (CMG)"
    enum:
      - "Affected"
      - "Unaffected"
      - "Not Reported"
      - "Unknown"
      - "Possibly affected"

  families: 
    $ref: "_definitions.yaml#/to_one"
  studies:
    $ref: "_definitions.yaml#/to_many"
